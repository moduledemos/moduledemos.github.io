{"id":440,"date":"2019-11-28T19:01:44","date_gmt":"2019-11-29T03:01:44","guid":{"rendered":"http:\/\/35.245.164.103\/?p=440"},"modified":"2019-12-06T18:17:38","modified_gmt":"2019-12-07T02:17:38","slug":"served","status":"publish","type":"post","link":"http:\/\/35.245.164.103\/served\/","title":{"rendered":"Served; Build RESTful C++ servers"},"content":{"rendered":"\n<p class=\"blog\"><a href=\"https:\/\/github.com\/meltwater\/served\" target=\"_blank\" rel=\"noreferrer noopener\" aria-label=\" (opens in a new tab)\">Served<\/a> is a C++ library for easy creation of highly performant web servers. It presents a clean and elegant modern C++ interface, drastically reducing the amount of boiler-plate code that would normally be needed. Overall, it looks very promising for when you want everything to just work, without compromising on performance. Now, let&#8217;s dive right into it. <\/p>\n\n\n\n<h2>Getting To Hello World<\/h2>\n\n\n\n<p>Getting started is fairly standard for a from-source installation, you can also opt to compile it into a deb or rpm package via the build flags. Running the following commands installs served on your system. This installation requires Boost 1.53 or newer, if you do not have Boost installed on your system, you can install it using your favorite package manager or by <a href=\"http:\/\/35.245.164.103\/how-to-install-the-boost-c-libraries\/\">following these instructions<\/a>.<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"shell\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">git clone https:\/\/github.com\/meltwater\/served.git\nmkdir served\/served.build &amp;&amp; cd served\/served.build\ncmake ..\/served &amp;&amp; make\nsudo make install<\/pre>\n\n\n\n<p>Now, that you have it installed, it is time to build a simple webserver. This server will just give back &#8220;Hello world!&#8221; when you query against the endpoint <code>GET \/hello.<\/code><\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"cpp\" data-enlighter-theme=\"\" data-enlighter-highlight=\"4, 6-9, 11-12\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"main.cpp\" data-enlighter-group=\"\">#include &lt;served\/served.hpp>\n\nint main() {\n\tserved::multiplexer mux;\n\n\tmux.handle(\"\/hello\")\n\t\t.get([](served::response &amp; res, const served::request &amp; req) {\n\t\t\tres &lt;&lt; \"Hello world!\\n\";\n\t\t});\n\n\tserved::net::server server(\"0.0.0.0\", \"8080\", mux);\n\tserver.run(10);\n\n\treturn 0;\n}<\/pre>\n\n\n\n<p>To compile your program, you will need to link against the pthread, boost_system, and served shared objects, and use at least C++-11. On Linux, this would look roughly like the following.<\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"shell\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">g++ main.cpp -o demo -std=c++17 -pthread -lboost_system -lserved<\/pre>\n\n\n\n<p>Just run the binary and visit the URL <a rel=\"noreferrer noopener\" aria-label=\" (opens in a new tab)\" href=\"http:\/\/localhost:8080\/hello\" target=\"_blank\">http:\/\/localhost:8080\/hello<\/a> in your browser, and you have successfully reached the hello-world. All of the code for this demo is <a href=\"https:\/\/github.com\/moduledemos\/served-demo\">available on github<\/a>.<\/p>\n\n\n\n<h2>Performance<\/h2>\n\n\n\n<p>Let&#8217;s take a quick look at the performance of C++ Served. At only 60k, the output binary from that demo is surprising small on my system. Of course, this is not the statically linked binary size. For this benchmark, we will be using <a rel=\"noreferrer noopener\" aria-label=\"Vegeta (opens in a new tab)\" href=\"https:\/\/github.com\/tsenart\/vegeta\" target=\"_blank\">Vegeta<\/a> for load testing. <\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"generic\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"false\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">Requests      [total, rate, throughput]    99999, 20000.17, 19057.02\nDuration      [total, attack, wait]        5.000256833s, 4.999908146s, 348.687\u00b5s\nLatencies     [mean, 50, 90, 95, 99, max]  2.539834ms, 375.457\u00b5s, 7.240899ms, 8.184653ms, 38.421652ms, 1.691368283s\nBytes In      [total, mean]                1238770, 12.39\nBytes Out     [total, mean]                0, 0.00\nSuccess       [ratio]                      95.29%\nStatus Codes  [code:count]                 0:4709  200:95290  \n\n<\/pre>\n\n\n\n<p>On my machine (Intel(R) Core(TM) i9-9900K CPU @ 3.60GHz 16 threads), the basic hello world server was able to handle around 19,000 requests per second! Additionally, it was able to maintain relatively low CPU usage during this attack, using only ~30% of the capacity available to it. <\/p>\n\n\n\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"generic\" data-enlighter-theme=\"\" data-enlighter-highlight=\"\" data-enlighter-linenumbers=\"false\" data-enlighter-lineoffset=\"\" data-enlighter-title=\"\" data-enlighter-group=\"\">Requests      [total, rate, throughput]    150000, 30000.10, 14094.09\nDuration      [total, attack, wait]        7.948649187s, 4.999982507s, 2.94866668s\nLatencies     [mean, 50, 90, 95, 99, max]  9.756488ms, 5.137985ms, 7.529834ms, 7.989994ms, 51.273487ms, 6.782636245s\nBytes In      [total, mean]                1456377, 9.71\nBytes Out     [total, mean]                0, 0.00\nSuccess       [ratio]                      74.69%\nStatus Codes  [code:count]                 0:37971  200:112029 <\/pre>\n\n\n\n<p>As the request rate increases above 20k, the performance started to degrade. Here, it seems like 20k requests per second is the sweet spot. Despite this, the performance of the library is very satisfactory under the given load. The majority of requests took under 1ms when it was under the 20k stress test. This should be more than enough to meet the needs of all but the most extreme demands. <\/p>\n","protected":false},"excerpt":{"rendered":"<p>Served is a C++ library for easy creation of highly performant web servers. It presents a clean and elegant modern C++ interface, drastically reducing the amount of boiler-plate code that would normally be needed. Overall, it looks very promising for when you want everything to just work, without compromising on performance. Now, let&#8217;s dive right [&hellip;]<\/p>\n","protected":false},"author":1,"featured_media":450,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"_et_pb_use_builder":"off","_et_pb_old_content":"","_et_gb_content_width":""},"categories":[7],"tags":[14,13,16,17,18,15,19],"yst_prominent_words":[188,198,195,194,138,192,136,48,191,196,189,218,193,132,187,184,197,190,186,185],"yoast_head":"<!-- This site is optimized with the Yoast SEO Premium plugin v14.1 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<title>Served; Build RESTful C++ servers - Module Safari<\/title>\n<meta name=\"description\" content=\"Served is a C++ library for easy creation of highly performant web servers. It presents a clean and elegant modern C++ interface...\" \/>\n<meta name=\"robots\" content=\"index, follow\" \/>\n<meta name=\"googlebot\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<meta name=\"bingbot\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"http:\/\/35.245.164.103\/served\/\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"Served; Build RESTful C++ servers - Module Safari\" \/>\n<meta property=\"og:description\" content=\"Served is a C++ library for easy creation of highly performant web servers. It presents a clean and elegant modern C++ interface...\" \/>\n<meta property=\"og:url\" content=\"http:\/\/35.245.164.103\/served\/\" \/>\n<meta property=\"og:site_name\" content=\"Module Safari\" \/>\n<meta property=\"article:published_time\" content=\"2019-11-29T03:01:44+00:00\" \/>\n<meta property=\"article:modified_time\" content=\"2019-12-07T02:17:38+00:00\" \/>\n<meta property=\"og:image\" content=\"http:\/\/35.245.164.103\/wp-content\/uploads\/2019\/11\/served-logo.png\" \/>\n\t<meta property=\"og:image:width\" content=\"300\" \/>\n\t<meta property=\"og:image:height\" content=\"300\" \/>\n<meta name=\"twitter:card\" content=\"summary_large_image\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"Organization\",\"@id\":\"http:\/\/35.245.164.103\/#organization\",\"name\":\"Module Safari\",\"url\":\"http:\/\/35.245.164.103\/\",\"sameAs\":[],\"logo\":{\"@type\":\"ImageObject\",\"@id\":\"http:\/\/35.245.164.103\/#logo\",\"inLanguage\":\"en-US\",\"url\":\"http:\/\/35.245.164.103\/wp-content\/uploads\/2019\/11\/PNG-Logo-02-not-transparent.png\",\"width\":2026,\"height\":530,\"caption\":\"Module Safari\"},\"image\":{\"@id\":\"http:\/\/35.245.164.103\/#logo\"}},{\"@type\":\"WebSite\",\"@id\":\"http:\/\/35.245.164.103\/#website\",\"url\":\"http:\/\/35.245.164.103\/\",\"name\":\"Module Safari\",\"description\":\"development simplified\",\"publisher\":{\"@id\":\"http:\/\/35.245.164.103\/#organization\"},\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":\"http:\/\/35.245.164.103\/?s={search_term_string}\",\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"ImageObject\",\"@id\":\"http:\/\/35.245.164.103\/served\/#primaryimage\",\"inLanguage\":\"en-US\",\"url\":\"http:\/\/35.245.164.103\/wp-content\/uploads\/2019\/11\/served-logo.png\",\"width\":300,\"height\":300},{\"@type\":\"WebPage\",\"@id\":\"http:\/\/35.245.164.103\/served\/#webpage\",\"url\":\"http:\/\/35.245.164.103\/served\/\",\"name\":\"Served; Build RESTful C++ servers - Module Safari\",\"isPartOf\":{\"@id\":\"http:\/\/35.245.164.103\/#website\"},\"primaryImageOfPage\":{\"@id\":\"http:\/\/35.245.164.103\/served\/#primaryimage\"},\"datePublished\":\"2019-11-29T03:01:44+00:00\",\"dateModified\":\"2019-12-07T02:17:38+00:00\",\"description\":\"Served is a C++ library for easy creation of highly performant web servers. It presents a clean and elegant modern C++ interface...\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"http:\/\/35.245.164.103\/served\/\"]}]},{\"@type\":\"Article\",\"@id\":\"http:\/\/35.245.164.103\/served\/#article\",\"isPartOf\":{\"@id\":\"http:\/\/35.245.164.103\/served\/#webpage\"},\"author\":{\"@id\":\"http:\/\/35.245.164.103\/#\/schema\/person\/a31876f85a9f031cf62afd4e79f746aa\"},\"headline\":\"Served; Build RESTful C++ servers\",\"datePublished\":\"2019-11-29T03:01:44+00:00\",\"dateModified\":\"2019-12-07T02:17:38+00:00\",\"commentCount\":0,\"mainEntityOfPage\":{\"@id\":\"http:\/\/35.245.164.103\/served\/#webpage\"},\"publisher\":{\"@id\":\"http:\/\/35.245.164.103\/#organization\"},\"image\":{\"@id\":\"http:\/\/35.245.164.103\/served\/#primaryimage\"},\"keywords\":\"c++,cpp,http,rest,restful,served,server\",\"articleSection\":\"C++\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"CommentAction\",\"name\":\"Comment\",\"target\":[\"http:\/\/35.245.164.103\/served\/#respond\"]}]},{\"@type\":[\"Person\"],\"@id\":\"http:\/\/35.245.164.103\/#\/schema\/person\/a31876f85a9f031cf62afd4e79f746aa\",\"name\":\"Nathaniel Blakely\",\"image\":{\"@type\":\"ImageObject\",\"@id\":\"http:\/\/35.245.164.103\/#personlogo\",\"inLanguage\":\"en-US\",\"url\":\"http:\/\/1.gravatar.com\/avatar\/1d85a4c5bf257b6a8972ab9bbaee0b51?s=96&d=mm&r=g\",\"caption\":\"Nathaniel Blakely\"}}]}<\/script>\n<!-- \/ Yoast SEO Premium plugin. -->","_links":{"self":[{"href":"http:\/\/35.245.164.103\/wp-json\/wp\/v2\/posts\/440"}],"collection":[{"href":"http:\/\/35.245.164.103\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/35.245.164.103\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/35.245.164.103\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"http:\/\/35.245.164.103\/wp-json\/wp\/v2\/comments?post=440"}],"version-history":[{"count":30,"href":"http:\/\/35.245.164.103\/wp-json\/wp\/v2\/posts\/440\/revisions"}],"predecessor-version":[{"id":696,"href":"http:\/\/35.245.164.103\/wp-json\/wp\/v2\/posts\/440\/revisions\/696"}],"wp:featuredmedia":[{"embeddable":true,"href":"http:\/\/35.245.164.103\/wp-json\/wp\/v2\/media\/450"}],"wp:attachment":[{"href":"http:\/\/35.245.164.103\/wp-json\/wp\/v2\/media?parent=440"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/35.245.164.103\/wp-json\/wp\/v2\/categories?post=440"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/35.245.164.103\/wp-json\/wp\/v2\/tags?post=440"},{"taxonomy":"yst_prominent_words","embeddable":true,"href":"http:\/\/35.245.164.103\/wp-json\/wp\/v2\/yst_prominent_words?post=440"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}